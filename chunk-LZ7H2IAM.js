import{Va as n,db as u,gb as l,hb as c,ib as d,jb as m,qb as r,r as h,u as s}from"./chunk-ML3SWCJJ.js";var I=(()=>{class i extends m{get thumb(){return!this.user.thumb||this.user.thumb.includes("assets/default.png")?"assets/default.png":this.url+this.user.thumb}constructor(e,t,a,p,g){super({name:"user"}),this._http=e,this._store=t,this._alert=a,this._core=p,this._router=g,this.url=r.url,this.roles=(r.roles||[]).concat(["admin"]),this.employees=r.roles||[],this.mode="dark",this.modes=["dark","white"],this.users=this.getDocs(),this.user=localStorage.getItem("waw_user")?JSON.parse(localStorage.getItem("waw_user")):this.new(),this._changingPassword=!1,this.fetch({},{name:"me"}).subscribe(o=>{o?(!localStorage.getItem("waw_user")&&this._router.url==="/sign"&&this._router.navigateByUrl("/profile"),this.setUser(o),this.get({query:r.appId?"appId="+r.appId:""})):localStorage.getItem("waw_user")&&this.logout()}),this._store.get("mode",o=>{o?this.setMode(o):this.setMode("dark")})}setMode(e="white"){if(e==="white"){this._store.remove("mode");for(let t of this.modes)document.body.parentNode.classList.remove(t)}else this._store.set("mode",e),document.body.parentNode.classList.add(e);this.mode=e}setUser(e){this.user=e,localStorage.setItem("waw_user",JSON.stringify(e)),this._core.complete("us.user")}role(e){return!!(this.user?.is||{})[e]}updateMe(){this.setUser(this.user),this.update(this.user)}updateMeAfterWhile(){this.setUser(this.user),this.updateAfterWhile(this.user)}changePassword(e,t){this._changingPassword||(this._changingPassword=!0,this._http.post("/api/user/changePassword",{newPass:t,oldPass:e},a=>{this._changingPassword=!1,a?this._alert.info({text:"Successfully changed password"}):this._alert.error({text:"Incorrect current password"})}))}logout(){this.user=this.new(),localStorage.removeItem("waw_user"),this._http.remove("token"),this._http.get("/api/user/logout"),this._router.navigateByUrl("/sign"),setTimeout(()=>{location.reload()},100)}updateAdmin(e){this.update(e,{name:"admin"})}deleteAdmin(e){this.delete(e,{name:"admin"})}static{this.\u0275fac=function(t){return new(t||i)(s(c),s(l),s(d),s(u),s(n))}}static{this.\u0275prov=h({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();export{I as a};
