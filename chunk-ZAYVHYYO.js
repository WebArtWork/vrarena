import{a as K}from"./chunk-MYCHKJST.js";import{a as Q}from"./chunk-UWDWWCS2.js";import{a as H,b as G}from"./chunk-E4JPN7HR.js";import{a as q}from"./chunk-LZ7H2IAM.js";import{e as U}from"./chunk-QVDMXOLA.js";import{Ga as F,H as k,Ha as P,Ia as I,J as s,La as T,M as p,N as y,O as S,R as _,T as a,Va as V,Wa as j,X as o,Y as u,Z as E,Za as z,a as b,aa as f,b as w,ba as h,ca as c,db as A,gb as N,ib as R,ka as d,la as D,s as x,sb as L,ta as M,tb as $,ua as B,vb as J,wa as O,x as m,y as l}from"./chunk-ML3SWCJJ.js";var ee=n=>({invalid:n});function te(n,v){if(n&1){let e=f();o(0,"div",12)(1,"wcalendar",13),h("todayClicked",function(i){m(e);let r=c();return l(r.setDate(i))})("dateClicked",function(i){m(e);let r=c();return l(r.setDate(i))}),u()()}}function ie(n,v){if(n&1){let e=f();o(0,"winput",26),h("wChange",function(i){let r=m(e).$implicit,C=c(2);return l(C.setTime(r,i))}),u()}if(n&2){let e=v.$implicit,t=c(2);a("disabled",t.disabled(t.reservation.date,e))("value",t.reservation.times.includes(e))("label",e)}}function ne(n,v){n&1&&(o(0,"div",27),d(1," \u041F\u043E\u043B\u0435 \u043E\u0431\u043E\u0432'\u044F\u0437\u043A\u043E\u0432\u0435 "),u())}function re(n,v){if(n&1){let e=f();o(0,"div",12)(1,"div",14)(2,"span",15),d(3),B(4,"date"),u(),o(5,"wbutton",16),h("click",function(){m(e);let i=c();return l(i.show="calendar")}),d(6," Common.Change Date"),u()(),o(7,"div",17),_(8,ie,1,3,"winput",18),u(),o(9,"winput",19),h("wChange",function(i){m(e);let r=c();return r.reservation.name=i+"",l(r.update())}),u(),o(10,"winput",20),h("wChange",function(i){m(e);let r=c();return r.reservation.phone=i+"",l(r.update())}),u(),o(11,"div",21),d(12," \u042F\u043A\u0449\u043E \u0437\u0430\u043F\u0438\u0441 \u0437\u0434\u0456\u0439\u0441\u043D\u044E\u0454 \u0434\u0438\u0442\u0438\u043D\u0430 \u0434\u043E 12 \u0440\u043E\u043A\u0456\u0432 \u2014 \u043F\u0440\u043E\u0441\u0438\u043C\u043E \u0437\u0430\u043B\u0438\u0448\u0438\u0442\u0438 \u043A\u043E\u043D\u0442\u0430\u043A\u0442 \u0431\u0430\u0442\u044C\u043A\u0456\u0432. "),u(),_(13,ne,2,0,"div",22),o(14,"winput",23),h("wChange",function(i){m(e);let r=c();return r.reservation.notes=i+"",l(r.update())}),u(),o(15,"wbutton",24),h("wClick",function(){m(e);let i=c();return l(i.book())}),o(16,"span",25),d(17,"Common.Book"),u()()()}if(n&2){let e=c();s(3),D(O(4,7,e.reservation.date,"dd.MM.yyyy")),s(5),a("ngForOf",e.times),s(),a("value",e.userService.user.name||e.reservation.name),s(),a("value",e.userService.user.phone||e.reservation.phone)("ngClass",M(10,ee,e.formSubmitted&&!e.reservation.phone)),s(3),a("ngIf",e.formSubmitted&&!e.reservation.phone),s(),a("value",e.reservation.notes)}}function oe(n,v){n&1&&(o(0,"div",28)(1,"div"),d(2," \u0412\u0430\u0448\u0435 \u043F\u0440\u043E\u0445\u0430\u043D\u043D\u044F \u0449\u043E\u0434\u043E \u0431\u0440\u043E\u043D\u044E\u0432\u0430\u043D\u043D\u044F \u043D\u0430 \u043E\u0431\u0440\u0430\u043D\u0443 \u0433\u043E\u0434\u0438\u043D\u0443 \u043F\u0440\u0438\u0439\u043D\u044F\u0442\u043E. \u041D\u0430\u0448 \u043C\u0435\u043D\u0435\u0434\u0436\u0435\u0440 \u0437\u0432'\u044F\u0436\u0435\u0442\u044C\u0441\u044F \u0437 \u0432\u0430\u043C\u0438 \u043D\u0430\u0439\u0431\u043B\u0438\u0436\u0447\u0438\u043C \u0447\u0430\u0441\u043E\u043C \u0434\u043B\u044F \u043F\u0456\u0434\u0442\u0432\u0435\u0440\u0434\u0436\u0435\u043D\u043D\u044F. \u0414\u044F\u043A\u0443\u0454\u043C\u043E \u0437\u0430 \u0432\u0430\u0448 \u0432\u0438\u0431\u0456\u0440! "),u(),o(3,"a",29),d(4,"Common.My reservations"),u()())}var g=(()=>{class n{constructor(e,t,i,r,C,W,X){this._reservationService=e,this._gameService=t,this.userService=i,this._store=r,this._alert=C,this._core=W,this._router=X,this.formSubmitted=!1,this.game=this._router.url.includes("/book/")?this._gameService.getByRrlOrId(this._router.url.replace("/book/","")):null,this.reservation=this._reservationService.new(),this.show="date",this.times=["10:00 - 11:00","11:15 - 12:15","12:30 - 13:30","13:45 - 14:45","14:00 - 15:00","15:15 - 16:15","16:30 - 17:30","17:45 - 18:45","18:00 - 19:00","19:15 - 20:15","20:30 - 21:30","21:45 - 22:45"],this.reservations=[],this.reservationsByDateTime={},this.userService.user.email?(this.reservation.date=this._reservationService.date(),this.reservation.yearmonth=this._reservationService.yearmonth(),this.reservation.times=[],this.reservation.name=this.userService.user.name,this.reservation.phone=this.userService.user.phone,this.load()):this._store.getJson("reservation",Y=>{this.reservation=Y||w(b({},this.reservation),{yearmonth:this._reservationService.yearmonth(),date:this._reservationService.date(),times:[]}),this.load()})}update(){if(this.userService.user.email||this._store.setJson("reservation",this.reservation),!this.reservation.name||!this.reservation.phone){console.warn("\u0417\u0430\u043F\u043E\u0432\u043D\u0456\u0442\u044C \u043E\u0431\u043E\u0432\u2019\u044F\u0437\u043A\u043E\u0432\u0456 \u043F\u043E\u043B\u044F!");return}}load(){let e=this.reservation.date.split(".");e.pop(),this.reservation.yearmonth!==e.join(".")&&(this.reservation.yearmonth=e.join("."),this._reservationService.get({query:`yearmonth=${this.reservation.yearmonth}`},{name:"public"}).subscribe(t=>{this.reservations=t,this.reservationsByDateTime={};for(let i of t)for(let r of i.times)this.reservationsByDateTime[i.date+r]=i}))}book(){if(this.formSubmitted=!0,!this.reservation.times?.length)return this._alert.error({unique:"book",text:"\u0412\u043A\u0430\u0436\u0456\u0442\u044C \u0447\u0430\u0441 \u0440\u0435\u0437\u0435\u0440\u0432\u0430\u0446\u0456\u0457"});if(!this.reservation.phone?.length||this.reservation.phone?.length<8)return this._alert.error({unique:"book",text:"\u0412\u043A\u0430\u0436\u0456\u0442\u044C \u0441\u0432\u0456\u0439 \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0443"});this.userService.user.email&&(!this.userService.user.name||!this.userService.user.phone)&&(this.userService.user.name=this.userService.user.name||this.reservation.name,this.userService.user.phone=this.userService.user.phone||this.reservation.phone,this.userService.updateMe()),this._store.remove("reservation"),this.reservation.deviceID=this._core.deviceID,this._reservationService.create(this.reservation).subscribe(()=>{this.show="booked"})}back(){window.history.back()}setDate(e){if(this._reservationService.isPastDate(e))return;this.show="date",this.reservation.date=e;let t=e.split(".");t.unshift(),this.reservation.yearmonth=t.join("."),this.load(),this.update()}setTime(e,t){this.reservation.times=this.reservation.times||[],t?this.reservation.times.push(e):this.reservation.times=this.reservation.times.filter(i=>i!==e),this.update()}disabled(e,t){return this.reservationsByDateTime[e+t]?.status==="Confirmed"||e===this._reservationService.date()&&t.split(":").map(Number)[0]<new Date().getHours()-1}static{this.\u0275fac=function(t){return new(t||n)(p(K),p(Q),p(q),p(N),p(R),p(A),p(V))}}static{this.\u0275cmp=y({type:n,selectors:[["ng-component"]],standalone:!1,decls:14,vars:4,consts:[[1,"documents-wrapper"],[1,"documents-container"],[1,"documents-list"],[1,"documents-header"],[1,"documents-header-left"],["routerLink","/profile",1,"documents-header-left__avatar"],["alt","",3,"src"],[1,"documents-header__title"],[1,"documents-main","documents-main--nobar"],[1,"documents-main-content"],["class","documents-main-row",4,"ngIf"],["class","documents-main-row book-finish",4,"ngIf"],[1,"documents-main-row"],[3,"todayClicked","dateClicked"],[1,"book__header"],[1,"book__header-date"],["translate","",1,"w-btn","_primary","book__header-btn",3,"click"],[1,"book__time"],["class","book-input","type","checkbox",3,"disabled","value","label","wChange",4,"ngFor","ngForOf"],["placeholder","\u0412\u0430\u0448\u0435 \u0456\u043C`\u044F","label","\u0406\u043C`\u044F",1,"book-input",3,"wChange","value"],["placeholder","\u0412\u0430\u0448 \u0442\u0435\u043B\u0435\u0444\u043E\u043D","label","\u0422\u0435\u043B\u0435\u0444\u043E\u043D",1,"book-input",3,"wChange","value","ngClass"],[1,"book__hint"],["class","error-message",4,"ngIf"],["placeholder","\u0414\u043E\u0434\u0430\u0442\u043A\u043E\u0432\u0430 \u0456\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0456\u044F","label","\u0406\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0456\u044F",1,"book-input",3,"wChange","value"],[3,"wClick"],["translate",""],["type","checkbox",1,"book-input",3,"wChange","disabled","value","label"],[1,"error-message"],[1,"documents-main-row","book-finish"],["routerLink","/reservations","translate",""]],template:function(t,i){t&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),E(6,"img",6),u()(),o(7,"div",7),d(8,"\u0417\u0430\u0431\u0440\u043E\u043D\u044E\u0439\u0442\u0435 \u0447\u0430\u0441 \u0433\u0440\u0438"),u()(),o(9,"div",8)(10,"div",9),_(11,te,2,0,"div",10)(12,re,18,12,"div",10)(13,oe,5,0,"div",11),u()()()()()),t&2&&(s(6),a("src",i.userService.thumb,k),s(5),a("ngIf",i.show==="calendar"),s(),a("ngIf",i.show==="date"),s(),a("ngIf",i.show==="booked"))},dependencies:[j,L,F,P,I,$,J,H,T],styles:["winput.invalid .w-forms__title{color:#c55a5a}  winput.invalid input{border:1px solid rgb(197,90,90)}.error-message[_ngcontent-%COMP%]{color:#c55a5a;font-size:12px;margin-top:-10px}.book-input[_ngcontent-%COMP%]{margin-bottom:6px;display:block;color:var(--c-text-primary);flex:0 0 50%}.book-input[_ngcontent-%COMP%]:last-child{margin-bottom:0}.book-input[_ngcontent-%COMP%]   .check-label[_ngcontent-%COMP%]{width:fit-content}.book-input[_ngcontent-%COMP%]   .check-label[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-size:14px}.book__header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-bottom:20px}.book__header-date[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:var(--c-text-primary)}.book__header-btn[_ngcontent-%COMP%]{max-width:200px;background:transparent!important;border:2px solid rgba(141,124,202,.6588235294);color:var(--c-text-primary)}.book__time[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap;max-width:510px}.book__hint[_ngcontent-%COMP%]{font-size:13px;font-weight:600;color:var(--c-text-primary);margin:auto 10px 20px}.book-finish[_ngcontent-%COMP%]{text-align:center}.book-finish[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{color:var(--c-text-primary);font-size:20px}.book-finish[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{background:linear-gradient(170deg,#c74662,#7251ea);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-size:20px;font-weight:900;display:block;border-bottom:3px solid var(--c-text-primary);width:fit-content;margin:0 auto;padding:10px 0 8px}@media screen and (max-width: 479px){.check-label[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-size:14px}.book__header-btn[_ngcontent-%COMP%]{width:135px!important;height:35px!important;padding:0!important}.book__header-date[_ngcontent-%COMP%]{font-size:20px}.book-input[_ngcontent-%COMP%]{margin-bottom:15px}}"]})}}return n})();var ue=[{path:"",component:g},{path:":urlOrID",component:g}],ke=(()=>{class n{static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275mod=S({type:n})}static{this.\u0275inj=x({imports:[z.forChild(ue),U,G]})}}return n})();export{ke as BookModule};
